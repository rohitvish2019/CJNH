<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/prescriptionForm.css">
    <title>Prescription</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js" integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body onload="getVisitdata()">
    <div class="main-body">
        <div class="header">
            <div class="logo" style="padding: 1%;">
                <img src="/images/CJNH_Logo_Black.png" alt="" srcset="" height="140%" width="130%">
            </div>
            <div class="name">
                <label style="font-size: 35px;font-weight: bolder; color: rgb(201, 8, 8);">डॉ. चंदा &nbsp;जैन &nbsp;नर्सिंग &nbsp;होम</label>
                <label  style="font-size: 20px; font-weight: 500;margin-top: 0.3%;">सिविल वार्ड नंबर 7 दमोह (म. प्र.)</label>
                <label style="font-size: 17px;">Mob: 6263169195, Ph No: 07812-222441</label>
            </div>
            <div class="logo" style="margin: 10px 5px 0px 0px; padding: 10px;">
                <img src="/images/doctorLogo.jpg" alt="" srcset="" height="140%" width="100%">
            </div>
        </div>
        <div class="doctors-info">
            <div class="doc-info-left">
                <label class="doc-name">डॉ. अनुज जैन</label>
                <label style="font-weight: bold;margin-bottom: 2%;">MBBS, DGO</label>
                <label class="old-info">स्त्री रोग विशेषज्ञ</label>
                <label class="old-info">CF. Sr. No. Addl./MPMC-7259</label>
                <label class="old-info">मिलने का समय</label>
                <label class="old-info">सुबह 10 बजे से शाम 5 बजे तक</label>
                
            </div>
            <div class="hospital-photo">
                
            </div>
            <div class="doc-info-right">
                <label class="doc-name">डॉ. स्वाति जैन</label>
                <label style="font-weight: bold;margin-bottom: 2%;">MBBS, DGO</label>
                <label class="old-info">स्त्री रोग विशेषज्ञ</label>
                <label class="old-info">CF. SR. No. Addl./MPMC-6978</label>
                <label class="old-info">मिलने का समय</label>
                <label class="old-info">सुबह 11बजे से 1 बजे तक, 1:30 से शाम 3 बजे तक</label>
                
            </div>
        </div>
        <div class="patient-info">
            <label hidden for="" id="visitId"><%=visit._id%></label>
            <div class="patient-data" style="width: 9%; ">
                <small for=""><b>ID</b></small>
                <label for="" id=""><%=visit.Patient.Id%></label>
            </div>
            <div class="patient-data" style="width: 32%;">
                <small for=""><b>Name</b></small>
                <label for=""><%=visit.Patient.Name%></label>
            </div>
            <div class="patient-data" style="width: 7%;">
                <small for=""><b>Age</b></small>
                <label for=""><%=visit.Patient.Age%></label>
            </div>
            <div class="patient-address" style="width: 34%;">
                <small for=""><b>Address</b></small>
                <label for=""><%=visit.Patient.Address%></label>
            </div>
            <div class="patient-data" style="width: 18%; ">
                <small for=""><b>Date</b></small>
                <%let months= ['Jan','Feb','Mar','Apr','May','Jun','July','Aug','Sep','Oct','Nov','Dec']%>
                <label for=""><%=new Date().getDate() +'-'+ months[(Number(new Date().getMonth()))] +'-'+new Date().getFullYear() %></label>
            </div>
        </div>
        <div class="data-body">
            <div class="prescription" style="height: 72%;">
                <div style="width: 73%;">
                    <b>Investigation & History</b>
                    <textarea rows="6" cols="68" name="" id="investigation" placeholder=""></textarea>
                    <b>Complications</b>
                    <textarea rows="6" cols="68" name="" id="complications" placeholder=""></textarea>
                    <b>Other Information</b>
                    <textarea rows="5" cols="68" name="" id="otherInfo" placeholder=""></textarea>
                </div>
                
                <div class="investigationItems" style="width: 27%;">
                    <div style="text-align: center;">
                        <label style="text-align: center;font-weight: bold;">Invt Adv</label>
                    </div>
                    <div>
                        <label style="width: 60%;">CBC</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('CBC')" id="CBC">
                    </div>
                    <div>
                        <label style="width: 60%;">Bl gr & Rh</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('Blgr')" id="Blgr">
                    </div>
                    <div>
                        <label style="width: 60%;">RBS</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('RBS')" id="RBS">
                    </div>
                    <div>
                        <label style="width: 60%;">HIV</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('HIV')" id="HIV">
                    </div>
                    <div>
                        <label style="width: 60%;">HBsAg</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('HBsAg')" id="HBsAg">
                    </div>
                    <div>
                        <label style="width: 60%;">TSH</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('TSH')" id="TSH">
                    </div>
                    <div>
                        <label style="width: 60%;">Urine P.test</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('Urine-Ptest')" id="Urine-Ptest">
                    </div>
                    <div>
                        <label style="width: 60%;">&nbsp&nbsp; R/M</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('Urine-RM')" id="Urine-RM">
                    </div>
                    <div>
                        <label style="width: 60%;">&nbsp&nbsp; Culture</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('Urine-Culture')" id="Urine-Culture">
                    </div>
                    <div>
                        <label style="width: 60%;">&nbsp&nbsp; Sensitivity</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('Urine-Sensitivity')" id="Urine-Sensitivity">
                    </div>
                    <div>
                        <label style="width: 60%;">USG Obst</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('USG-Obst')" id="USG-Obst">
                    </div>
                    <div>
                        <label style="width: 60%;">&nbsp&nbsp; Colour Dop.</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('USG-ColourDop')" id="USG-ColourDop">
                    </div>
                    <div>
                        <label style="width: 60%;">&nbsp&nbsp; L.Abd</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('USG-LAbd')" id="USG-LAbd">
                    </div>
                    <div>
                        <label style="width: 60%;">&nbsp&nbsp; W.Abd</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('USG-WAbd')" id="USG-WAbd">
                    </div>
                    <div>
                        <label style="width: 60%;">Semen Analysis</label>
                        <input style="width: 35%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('SemenAnalysis')" id="SemenAnalysis">
                    </div>
                </div>
            </div>
            <div class="prescription" style="height: 28%;">
                <div style="width: 25%;padding-left: 5px;margin-top: 5px;display: flex;flex-direction: column;justify-content: space-between;">
                    <div>
                        <label style="width: 35%;">T1</label>
                        <input style="width: 60%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('T1')" id="T1">
                    </div>

                    <div>
                        <label style="width: 35%;">T2</label>
                        <input style="width: 60%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('T2')" id="T2">
                    </div>

                    <div>
                        <label style="width: 35%;">NT on</label>
                        <input style="width: 60%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('NT')" id="NT">
                    </div>

                    <div>
                        <label style="width: 35%;">TS on</label>
                        <input style="width: 60%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('TS')" id="TS">
                    </div>

                    <div>
                        <label style="width: 35%;">CD on</label>
                        <input style="width: 60%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('CD')" id="CD">
                    </div>
                    <div>
                        <label style="width: 35%;">F/up on</label>
                        <input style="width: 60%;border: none;border-bottom: .5px dotted black;" type="text" onchange="addChanges('FUP')" id="FUP">
                    </div>
                </div>
                <div style="width: 75%;">
                    
                </div>
            </div>
        </div>
        <div class="footer" style="padding-left: 1%;">
            <label>
                <p style="font-size: 12px;padding:0;margin: 0;">यह पर्चा वैधानिक कार्यवाही हेतु मान्य नहीं है</p>
                <p style="font-size: 12px;padding:0;margin: 0;">Prognosis & Complications Explained</p>
            </label>
        </div>
    </div>
    
    <button id="printButton" onclick="printPrescription()">Save & Print</button>
    <script>

        let changes = new Object();
        function printPrescription(){
            document.getElementById('printButton').style.display='none'
            changes['investigation'] = document.getElementById('investigation').value
            changes['complications'] = document.getElementById('complications').value
            changes['otherInfo'] = document.getElementById('otherInfo').value
            $.ajax({
                url:'/patients/saveVisitPrescriptions',
                data:{
                    visitId:document.getElementById('visitId').innerText,
                    visitData:changes,
                },
                type:'POST',
                success:function(data){
                    let items = document.getElementsByTagName('textarea');
                    for(let i=0;i<items.length;i++){
                        items[i].style.border='none'
                    }
                    window.print()
                }
            })
        }
        
        function getVisitdata(){
            $.ajax({
                url:'/patients/getPrescription/'+document.getElementById('visitId').innerText,
                type:'Get',
                success:function(data){
                    let keys = Object.keys(data.visitData)
                    for(let i=0;i<keys.length;i++){
                        document.getElementById(keys[i]).value=data.visitData[keys[i]]
                    }
                    console.log();
                },
                error:function(err){
                    console.log(err)
                }
            })
        }
        function addChanges(id){
            changes[id] = document.getElementById(id).value
        }
       
    </script>
</body>
</html>